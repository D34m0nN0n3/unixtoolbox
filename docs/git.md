## 14 Git

!!! abstract ""
    [Установка на Windows](#141-инструкция-по-установке-git-для-пользователей-windows) | [Файл настройки](#142-работа-с-файлом-настройки-gitconfig) | [Команды Git](#143-команды-git) | [Шпаргалка](#144-шпаргалка-командная-работа-в-git)

Система контроля версий — общее название ряда продуктов, таких как Git, Mercurial, Subversion и других.

!!! info "Как расшифровывается Git?"
    На английском сленге слово git означает «мерзавец». Но, по мнению Линуса Торвальдса, создателя Git, название может расшифровываться как угодно — в зависимости от настроения пользователя. Например, Global Information Tracker (англ. «глобальный информационный трекер») — когда у вас всё хорошо и Git работает отлично. А если что-то идёт не так, Git превращается в Goddamn Idiotic Truckload of sh*t (англ. «чёртов идиотский грузовик c ...»).

### 14.1 Инструкция по установке Git для пользователей Windows

В повседневной работе большинство пользователей Git используют консоли с наборами команд, похожие на те, что применяют в macOS и Linux. Для этого нужно установить специальный консольный инструмент для Windows, который называется Git Bash.

* Перейдите на эту [страницу официального сайта Git](https://git-scm.com/download/win).
* Скачайте одну из двух версий из категории Standalone Installer (англ. «автономный установщик»). Узнать тип вашей системы Windows можно в настройках.
* Запустите программу установки. Обратите внимание, куда будет установлен Git. Обычно это директория `C:\Program Files\Git`.
* Проверьте, что в списке устанавливаемых программ стоит галочка напротив пункта `Git Bash Here` — это позволит открывать консоль с Git в любой папке.
* Далее установщик предложит много опций. Для нашего курса достаточно оставить все настройки по умолчанию. Несколько раз нажмите Next (англ. «далее»), пока не начнётся процесс установки.
* После окончания установки нажмите Finish (англ. «завершить»).

Будьте осторожны: в подпапке `.git` хранится история изменений. Если удалить `.git`, то вся история проекта будет стёрта без возможности восстановления — останется только последняя версия файлов.

### 14.2 Работа с файлом настройки .gitconfig

!!! example ""
    **$ git config --global user.name "User Namovich"** - имя или ник нужно написать латиницей и в кавычках  
    **$ git config --global user.email username@email** - здесь нужно указать свой настоящий email  

Все глобальные настройки Git хранит в файле `.gitconfig` в домашней директории. Команды запишет в этот файл указанные имя и почту.

### 14.3 Команды Git

!!! example ""
    **$ git version** - показать версию git  
    **$ git init** - создали репозиторий  
    **$ git status**  
    **$ git add --all** # подготовили к сохранению все файлы в репозитории  
    **$ git add .** # добавить всю текущую папку  
    **$ git add <file>** # позволяет подготовить файл к сохранению  
    **$ git commit -m ‘Мой первый коммит!’** - после нажатия ++enter++ текущая версия файлов будет сохранена в репозитории с сообщением *Мой первый коммит!*  
    **$ git log** - просмотреть историю коммитов  
    **$ git remote add origin git@github.com:%ИМЯ_АККАУНТА%/first-project.git** - привязать удалённый репозиторий к локальному  
    **$ git push -u origin main** - отправить изменения на удалённый репозиторий, и связывае локальные и удаленные ветки (выполняется в первый раз)  
    **$ git restore --staged <file>** - убрать файл из staging поможет команда  
    **$ git reset --hard <commit hash>** - «откатить» коммит  
    **$ git diff** - просматриваем изменения в modified  
    **$ git diff --staged** - просматриваем изменения в staging area  
    **$ git log --oneline** - показывает первые несколько символов хеша и сообщение коммита  
    **$ git push** - Отправить изменения на удалённый репозиторий  
    **$ git clone https://github.com/%АККАУНТ%/%РЕПОЗИТАРИЙ%** - создаст копию удалённого репозитория на вашем компьютере или сервере  
    **$ git remote -v** - убедиться в том, что репозитории связаны  
    **$ git branch** - просмотреть ветки проекта  
    **$ git branch <название_ветки>** - создать ветку  
    **$ git checkout <название_ветки>** - переключиться на другую ветку  
    **$ git checkout -b <название_ветки>** - создать ветку и сразу переключиться на неё  
    **$ git diff <название_ветки1> <название_ветки2>** - сравнить ветки
    **$ git merge <название_ветки>** - выполнить слияние  
    **$ git branch -D <название_ветки>** - удалить ветку после объединения  
    **$ git pull** - забрать изменения из удалённого репозитория  

!!! info "Команда git status выведет:"
    * название текущей ветки: `On branch master` или `On branch main`;   
    * сообщение о том, что в репозитории ещё нет коммитов: `No commits yet`;  
    * сообщение, которое говорит: «чтобы что-нибудь закоммитить (то есть зафиксировать), нужно сначала это создать» — *nothing to commit (create/copy files and use "git add" to track*).  

!!! hint "Подсказка"
    Кстати, *Мой первый коммит!* — всё же не лучший вариант сообщения. Коммит нужно описывать так, чтобы было понятно, какие именно изменения были сделаны. Например: Д*обавлено важное дело в TODO*, *Добавлена сортировка имён*, *Исправлена ошибка в цикле* или *Добавлены заготовки рекламных текстов*.

!!! attention "Внимание"
    Конфликт — это ситуация, в которой один или несколько человек модифицировали один и тот же файл. При этом результаты таких модификаций оказались несовместимы и разобраться в том, какой из вариантов правильный, может только человек.

!!! help "Как разрешать конфликты: общие рекомендации"
    Во время слияния Git сам подсвечивает файлы, которые не смог объединить. Чтобы разобраться в ситуации, нужно сделать следующее:  
    * Заглянуть в файл, где произошёл конфликт.  
    * Изучить обе стороны конфликта — вашу версию и версию вашего коллеги. Ваша задача — правильно собрать две версии в итоговую, так чтобы изменения обеих сторон не потерялись. Новая версия станет текущей актуальной.  
    * Вручную удалить или подправить неактуальные изменения, если они есть.  
    * Подготовить изменения к сохранению и сделать коммит.  

!!! info "У каждого пул-реквеста есть:"
    * Название — краткое описание предлагаемых изменений. Например: Адаптивный заголовок сайта, Замена альбома на галерею и так далее.  
    * Описание — развёрнутое описание изменений. Это поле заполнять необязательно, но желательно.  
    * Исходная ветка — та, в которой вы работали. Например, feature/merge-request.  
    * Целевая ветка — основная ветка проекта, в которую вы хотите внести изменения.  

!!! info "Добавление SSH клучей"
    <video controls="" height="540" muted="" preload="auto" width="960"> <source src="assets/movies/SSH_Screencast.mp4" type="video/mp4"> <a href="assets/movies/SSH_Screencast.mp4">Скачайте видео</a>. </video>

### 14.4 Шпаргалка. Командная работа в Git

Модуль подошёл к концу, а это значит, что пришло время подвести итоги и запастись шпаргалкой!

##### Feature branch workflow

Самый популярный подход к работе с Git в команде — это `feature branch workflow`. В нём создают ветку для каждой задачи (например, для новой функциональности или исправления бага), а когда всё готово, вливают новую ветку в `main`.

Важные этапы этого процесса — пул-реквест и ревью изменений. Пул-реквест — это интерфейс, в котором можно обсудить изменения. Ревью — просмотр изменений другими участниками и один из способов проверить качество таких изменений.

Если вы уже участник проекта (или collaborator в терминах GitHub), можно клонировать репозиторий напрямую. А если нет, нужно предварительно сделать «форк». Также для участников доступна кнопка Merge после ревью, а для неучастников — нет.

##### Конфликты слияния

Когда один и тот же файл меняется в нескольких ветках, при их слиянии может произойти конфликт. Пугаться конфликтов не нужно, это нормальная часть работы с системами контроля версий. `IDE`, вроде `VSCode` или `Intellij IDEA`, помогут «склеить» файл из двух конфликтующих версий.

##### Алгоритм-шпаргалка для создания PR

1. Склонировать репозиторий.  
1.1. Если вы не участник проекта, предварительно сделать «форк» исходного репозитория.  
1.2. На странице репозитория или «форка» нажать кнопки: Code → SSH → скопировать ссылку.  
1.3. Выполнить команду `git clone <ссылка на репозиторий>`.  
2. Создать ветку для вашей задачи: `git checkout -b my-task-branch-name`.  
3. Добавить и «закоммитить» изменения, которые вы хотите внести в проект.  
4. «Запушить» ветку: `git push --set-upstream origin HEAD` или `git push -u origin my-task-branch-name`.  
4.1. GitHub (с помощью Git) выведет ссылку на создание PR. По ней нужно перейти.  
4.2. PR можно также создать через интерфейс GitHub.  
5. Сообщить о пул-реквесте ревьюеру.  
5.1. Иногда ревьюеры назначаются автоматически, тогда сообщать не нужно.  
6. Обсуждать с ревьюером предлагаемые изменения и вносить правки, пока эти изменения не будут одобрены (пока не будет получен «апрув»).  
6.1. Если кто-то добавил конфликтующие изменения в main, пока ваш PR был на ревью, нужно разрешить конфликт:  
* Обновить main: `git checkout main && git pull`.  
* Влить main в свою ветку: `git checkout my-task-branch-name && git merge main`.  
* Разрешить конфликты слияния с помощью IDE или вручную.  
* Создать коммит слияния: `git commit --no-edit` или `git commit -m 'merge main'`.  
* Сделать `git push` своей ветки.  
7. Нажать кнопку Merge или подождать, пока её нажмёт кто-то ещё.  
8. Ещё раз обновить main, чтобы «подтянуть» ваши изменения в основную ветку локального репозитория: `git checkout main && git pull`.  
9. Вы великолепны! Можете начинать снова со второго пункта.  

##### Алгоритм-шпаргалка для разрешения конфликтов слияния

1. Открыть проект в IDE (VS Code, IDEA или другие).
2. Открыть файл, в котором есть конфликт.
3. Выбрать, какие части файла нужно взять из одной ветки, а какие — из другой.
4. Когда конфликты разрешены, сделать коммит: `git commit --no-edit` или `git commit -m 'merge branch <название ветки>'`.

!!! check "Курс"
    [Основы работы с Git](https://practicum.yandex.ru/profile/git-basics/)

!!! hint "Сайт с интерактивными подсказками"
    [Git explorer](https://gitexplorer.com/)
